import re

f = open("EzLUTs_top_synth.v", "r")
text = f.read()
f.close()

regex = r"LUT6 #\(\s*\.INIT\(64'h6996966996696996\)\)\s*[^\s]+\s*\(\.I0\(([^\)]+)\),\s*\.I1\(([^\)]+)\),\s*\.I2\(([^\)]+)\),\s*\.I3\(([^\)]+)\),\s*\.I4\(([^\)]+)\),\s*\.I5\(([^\)]+)\),\s*\.O\(([^\)]+)\)\);"
replaceText = r"assign \7 = (\1 ^ \2 ^ \3 ^ \4 ^ \5 ^ \6);"
text = re.sub(regex, replaceText, text)

regex = r"LUT6 #\(\s*\.INIT\(64'h0000001000000000\)\)\s*[^\s]+\s*\(\.I0\(([^\)]+)\),\s*\.I1\(([^\)]+)\),\s*\.I2\(([^\)]+)\),\s*\.I3\(([^\)]+)\),\s*\.I4\(([^\)]+)\),\s*\.I5\(([^\)]+)\),\s*\.O\(([^\)]+)\)\);"
replaceText = r"assign \7 = ((~\1) & (~\2) & \3 & (~\4) & (~\5) & \6);"
text = re.sub(regex, replaceText, text)

regex = r"LUT6 #\(\s*\.INIT\(64'h8000000000000000\)\)\s*[^\s]+\s*\(\.I0\(([^\)]+)\),\s*\.I1\(([^\)]+)\),\s*\.I2\(([^\)]+)\),\s*\.I3\(([^\)]+)\),\s*\.I4\(([^\)]+)\),\s*\.I5\(([^\)]+)\),\s*\.O\(([^\)]+)\)\);"
replaceText = r"assign \7 = (\1 & \2 & \3 & \4 & \5 & \6);"
text = re.sub(regex, replaceText, text)

regex = r"LUT6 #\(\s*\.INIT\(64'h0000000096696996\)\)\s*[^\s]+\s*\(\.I0\(([^\)]+)\),\s*\.I1\(([^\)]+)\),\s*\.I2\(([^\)]+)\),\s*\.I3\(([^\)]+)\),\s*\.I4\(([^\)]+)\),\s*\.I5\(([^\)]+)\),\s*\.O\(([^\)]+)\)\);"
replaceText = r"assign \7 = ((\1 ^ \2 ^ \3 ^ \4 ^ \5) & (~\6));"
text = re.sub(regex, replaceText, text)

regex = r"LUT6 #\(\s*\.INIT\(64'h9669000000009669\)\)\s*[^\s]+\s*\(\.I0\(([^\)]+)\),\s*\.I1\(([^\)]+)\),\s*\.I2\(([^\)]+)\),\s*\.I3\(([^\)]+)\),\s*\.I4\(([^\)]+)\),\s*\.I5\(([^\)]+)\),\s*\.O\(([^\)]+)\)\);"
replaceText = r"assign \7 = ((~(\5 ^ \6))&(~(\1 ^ \2 ^ \3 ^ \4)));"
text = re.sub(regex, replaceText, text)

regex = r"LUT6 #\(\s*\.INIT\(64'h0000000100000000\)\)\s*[^\s]+\s*\(\.I0\(([^\)]+)\),\s*\.I1\(([^\)]+)\),\s*\.I2\(([^\)]+)\),\s*\.I3\(([^\)]+)\),\s*\.I4\(([^\)]+)\),\s*\.I5\(([^\)]+)\),\s*\.O\(([^\)]+)\)\);"
replaceText = r"assign \7 = ((~\1) & (~\2) & (~\3) & (~\4) & (~\5) & \6);"
text = re.sub(regex, replaceText, text)

regex = r"LUT6 #\(\s*\.INIT\(64'h6996000000006996\)\)\s*[^\s]+\s*\(\.I0\(([^\)]+)\),\s*\.I1\(([^\)]+)\),\s*\.I2\(([^\)]+)\),\s*\.I3\(([^\)]+)\),\s*\.I4\(([^\)]+)\),\s*\.I5\(([^\)]+)\),\s*\.O\(([^\)]+)\)\);"
replaceText = r"assign \7 = ((~(\5 ^ \6))&((\1 ^ \2 ^ \3 ^ \4)));"
text = re.sub(regex, replaceText, text)

regex = r"LUT6 #\(\s*\.INIT\(64'h0069690069000069\)\)\s*[^\s]+\s*\(\.I0\(([^\)]+)\),\s*\.I1\(([^\)]+)\),\s*\.I2\(([^\)]+)\),\s*\.I3\(([^\)]+)\),\s*\.I4\(([^\)]+)\),\s*\.I5\(([^\)]+)\),\s*\.O\(([^\)]+)\)\);"
replaceText = r"assign \7 = ((~(\4 ^ \5 ^ \6))&(~(\1 ^ \2 ^ \3)));"
text = re.sub(regex, replaceText, text)

regex = r"LUT6 #\(\s*\.INIT\(64'h0000000000000010\)\)\s*[^\s]+\s*\(\.I0\(([^\)]+)\),\s*\.I1\(([^\)]+)\),\s*\.I2\(([^\)]+)\),\s*\.I3\(([^\)]+)\),\s*\.I4\(([^\)]+)\),\s*\.I5\(([^\)]+)\),\s*\.O\(([^\)]+)\)\);"
replaceText = r"assign \7 = ((~\1) & (~\2) & \3 & (~\4) & (~\5) & (~\6));"
text = re.sub(regex, replaceText, text)

regex = r"LUT6 #\(\s*\.INIT\(64'h0096960096000096\)\)\s*[^\s]+\s*\(\.I0\(([^\)]+)\),\s*\.I1\(([^\)]+)\),\s*\.I2\(([^\)]+)\),\s*\.I3\(([^\)]+)\),\s*\.I4\(([^\)]+)\),\s*\.I5\(([^\)]+)\),\s*\.O\(([^\)]+)\)\);"
replaceText = r"assign \7 = ((~(\4 ^ \5 ^ \6))&((\1 ^ \2 ^ \3)));"
text = re.sub(regex, replaceText, text)

regex = r"LUT6 #\(\s*\.INIT\(64'h9669699600000000\)\)\s*[^\s]+\s*\(\.I0\(([^\)]+)\),\s*\.I1\(([^\)]+)\),\s*\.I2\(([^\)]+)\),\s*\.I3\(([^\)]+)\),\s*\.I4\(([^\)]+)\),\s*\.I5\(([^\)]+)\),\s*\.O\(([^\)]+)\)\);"
replaceText = r"assign \7 = ((\1 ^ \2 ^ \3 ^ \4 ^ \5) & (\6));"
text = re.sub(regex, replaceText, text)

regex = r"LUT6 #\(\s*\.INIT\(64'h0000000069969669\)\)\s*[^\s]+\s*\(\.I0\(([^\)]+)\),\s*\.I1\(([^\)]+)\),\s*\.I2\(([^\)]+)\),\s*\.I3\(([^\)]+)\),\s*\.I4\(([^\)]+)\),\s*\.I5\(([^\)]+)\),\s*\.O\(([^\)]+)\)\);"
replaceText = r"assign \7 = ((~(\1 ^ \2 ^ \3 ^ \4 ^ \5)) & (~\6));"
text = re.sub(regex, replaceText, text)

regex = r"LUT6 #\(\s*\.INIT\(64'h9600009600969600\)\)\s*[^\s]+\s*\(\.I0\(([^\)]+)\),\s*\.I1\(([^\)]+)\),\s*\.I2\(([^\)]+)\),\s*\.I3\(([^\)]+)\),\s*\.I4\(([^\)]+)\),\s*\.I5\(([^\)]+)\),\s*\.O\(([^\)]+)\)\);"
replaceText = r"assign \7 = ((\4 ^ \5 ^ \6)&(\1 ^ \2 ^ \3));"
text = re.sub(regex, replaceText, text)

regex = r"LUT6 #\(\s*\.INIT\(64'h0008000000000000\)\)\s*[^\s]+\s*\(\.I0\(([^\)]+)\),\s*\.I1\(([^\)]+)\),\s*\.I2\(([^\)]+)\),\s*\.I3\(([^\)]+)\),\s*\.I4\(([^\)]+)\),\s*\.I5\(([^\)]+)\),\s*\.O\(([^\)]+)\)\);"
replaceText = r"assign \7 = ((\1) & (\2) & (~\3) & (~\4) & (\5) & (\6));"
text = re.sub(regex, replaceText, text)

regex = r"LUT6 #\(\s*\.INIT\(64'h0000699669960000\)\)\s*[^\s]+\s*\(\.I0\(([^\)]+)\),\s*\.I1\(([^\)]+)\),\s*\.I2\(([^\)]+)\),\s*\.I3\(([^\)]+)\),\s*\.I4\(([^\)]+)\),\s*\.I5\(([^\)]+)\),\s*\.O\(([^\)]+)\)\);"
replaceText = r"assign \7 = (((\5 ^ \6))&((\1 ^ \2 ^ \3 ^ \4)));"
text = re.sub(regex, replaceText, text)

regex = r"LUT6 #\(\s*\.INIT\(64'h1000000000000000\)\)\s*[^\s]+\s*\(\.I0\(([^\)]+)\),\s*\.I1\(([^\)]+)\),\s*\.I2\(([^\)]+)\),\s*\.I3\(([^\)]+)\),\s*\.I4\(([^\)]+)\),\s*\.I5\(([^\)]+)\),\s*\.O\(([^\)]+)\)\);"
replaceText = r"assign \7 = ( (~\1) & (~\2) & \3 & \4 & \5 & \6 );"
text = re.sub(regex, replaceText, text)

regex = r"LUT6 #\(\s*\.INIT\(64'h0000000000000800\)\)\s*[^\s]+\s*\(\.I0\(([^\)]+)\),\s*\.I1\(([^\)]+)\),\s*\.I2\(([^\)]+)\),\s*\.I3\(([^\)]+)\),\s*\.I4\(([^\)]+)\),\s*\.I5\(([^\)]+)\),\s*\.O\(([^\)]+)\)\);"
replaceText = r"assign \7 = ( \1 & \2 & (~\3) & \4 & (~\5) & (~\6) );"
text = re.sub(regex, replaceText, text)

regex = r"LUT6 #\(\s*\.INIT\(64'h0000000000000002\)\)\s*[^\s]+\s*\(\.I0\(([^\)]+)\),\s*\.I1\(([^\)]+)\),\s*\.I2\(([^\)]+)\),\s*\.I3\(([^\)]+)\),\s*\.I4\(([^\)]+)\),\s*\.I5\(([^\)]+)\),\s*\.O\(([^\)]+)\)\);"
replaceText = r"assign \7 = ( \1 & (~\2) & (~\3) & (~\4) & (~\5) & (~\6) );"
text = re.sub(regex, replaceText, text)

regex = r"LUT6 #\(\s*\.INIT\(64'h0000000000000020\)\)\s*[^\s]+\s*\(\.I0\(([^\)]+)\),\s*\.I1\(([^\)]+)\),\s*\.I2\(([^\)]+)\),\s*\.I3\(([^\)]+)\),\s*\.I4\(([^\)]+)\),\s*\.I5\(([^\)]+)\),\s*\.O\(([^\)]+)\)\);"
replaceText = r"assign \7 = ( \1 & (~\2) & \3 & (~\4) & (~\5) & (~\6) );"
text = re.sub(regex, replaceText, text)

regex = r"LUT6 #\(\s*\.INIT\(64'h0000000800000000\)\)\s*[^\s]+\s*\(\.I0\(([^\)]+)\),\s*\.I1\(([^\)]+)\),\s*\.I2\(([^\)]+)\),\s*\.I3\(([^\)]+)\),\s*\.I4\(([^\)]+)\),\s*\.I5\(([^\)]+)\),\s*\.O\(([^\)]+)\)\);"
replaceText = r"assign \7 = ( \1 & \2 & (~\3) & (~\4) & (~\5) & \6 );"
text = re.sub(regex, replaceText, text)

regex = r"LUT6 #\(\s*\.INIT\(64'h0000008000000000\)\)\s*[^\s]+\s*\(\.I0\(([^\)]+)\),\s*\.I1\(([^\)]+)\),\s*\.I2\(([^\)]+)\),\s*\.I3\(([^\)]+)\),\s*\.I4\(([^\)]+)\),\s*\.I5\(([^\)]+)\),\s*\.O\(([^\)]+)\)\);"
replaceText = r"assign \7 = ( \1 & \2 & \3 & (~\4) & (~\5) & \6 );"
text = re.sub(regex, replaceText, text)

regex = r"LUT6 #\(\s*\.INIT\(64'h0800000000000000\)\)\s*[^\s]+\s*\(\.I0\(([^\)]+)\),\s*\.I1\(([^\)]+)\),\s*\.I2\(([^\)]+)\),\s*\.I3\(([^\)]+)\),\s*\.I4\(([^\)]+)\),\s*\.I5\(([^\)]+)\),\s*\.O\(([^\)]+)\)\);"
replaceText = r"assign \7 = ( \1 & \2 & (~\3) & \4 & \5 & \6 );"
text = re.sub(regex, replaceText, text)

regex = r"LUT6 #\(\s*\.INIT\(64'h6000006000000000\)\)\s*[^\s]+\s*\(\.I0\(([^\)]+)\),\s*\.I1\(([^\)]+)\),\s*\.I2\(([^\)]+)\),\s*\.I3\(([^\)]+)\),\s*\.I4\(([^\)]+)\),\s*\.I5\(([^\)]+)\),\s*\.O\(([^\)]+)\)\);"
replaceText = r"assign \7 = ((\1 ^ \2) & \3 & (~(\4 ^ \5)) & \6);"
text = re.sub(regex, replaceText, text)

regex = r"LUT6 #\(\s*\.INIT\(64'h0000000000004114\)\)\s*[^\s]+\s*\(\.I0\(([^\)]+)\),\s*\.I1\(([^\)]+)\),\s*\.I2\(([^\)]+)\),\s*\.I3\(([^\)]+)\),\s*\.I4\(([^\)]+)\),\s*\.I5\(([^\)]+)\),\s*\.O\(([^\)]+)\)\);"
replaceText = r"assign \7 = ((~\1) & (\2^\3^\4) & (~\5) & (~\6));"
text = re.sub(regex, replaceText, text)

regex = r"LUT2 #\(\s*\.INIT\(4'h6\)\)\s*[^\s]+\s*\(\.I0\(([^\)]+)\),\s*\.I1\(([^\)]+)\),\s*\.O\(([^\)]+)\)\);"
replaceText = r"assign \3 = (\1 ^ \2);"
text = re.sub(regex, replaceText, text)

regex = r"LUT3 #\(\s*\.INIT\(8'h96\)\)\s*[^\s]+\s*\(\.I0\(([^\)]+)\),\s*\.I1\(([^\)]+)\),\s*\.I2\(([^\)]+)\),\s*\.O\(([^\)]+)\)\);"
replaceText = r"assign \4 = (\1 ^ \2 ^ \3);"
text = re.sub(regex, replaceText, text)

regex = r"LUT4 #\(\s*\.INIT\(16'h6996\)\)\s*[^\s]+\s*\(\.I0\(([^\)]+)\),\s*\.I1\(([^\)]+)\),\s*\.I2\(([^\)]+)\),\s*\.I3\(([^\)]+)\),\s*\.O\(([^\)]+)\)\);"
replaceText = r"assign \5 = (\1 ^ \2 ^ \3 ^ \4);"
text = re.sub(regex, replaceText, text)

regex = r"LUT5 #\(\s*\.INIT\(32'h96696996\)\)\s*[^\s]+\s*\(\.I0\(([^\)]+)\),\s*\.I1\(([^\)]+)\),\s*\.I2\(([^\)]+)\),\s*\.I3\(([^\)]+)\),\s*\.I4\(([^\)]+)\),\s*\.O\(([^\)]+)\)\);"
replaceText = r"assign \6 = (\1 ^ \2 ^ \3 ^ \4 ^ \5);"
text = re.sub(regex, replaceText, text)

regex = r"LUT5 #\(\s*\.INIT\(32'h20000000\)\)\s*[^\s]+\s*\(\.I0\(([^\)]+)\),\s*\.I1\(([^\)]+)\),\s*\.I2\(([^\)]+)\),\s*\.I3\(([^\)]+)\),\s*\.I4\(([^\)]+)\),\s*\.O\(([^\)]+)\)\);"
replaceText = r"assign \6 = ( \1 & (~\2) & \3 & \4 & \5 );"
text = re.sub(regex, replaceText, text)

regex = r"LUT5 #\(\s*\.INIT\(32'h08000000\)\)\s*[^\s]+\s*\(\.I0\(([^\)]+)\),\s*\.I1\(([^\)]+)\),\s*\.I2\(([^\)]+)\),\s*\.I3\(([^\)]+)\),\s*\.I4\(([^\)]+)\),\s*\.O\(([^\)]+)\)\);"
replaceText = r"assign \6 = ( \1 & \2 & (~\3) & \4 & \5 );"
text = re.sub(regex, replaceText, text)

# Change bit endianess of input buffer
text = text.replace("[0:335]", "[335:0]")

regex = r"\(\* SOFT_HLUTNM [^\)]+\)\s*"
replaceText = r""
text = re.sub(regex, replaceText, text)


f = open("EzLUTs_top_synth_mod.v", "w")
f.write(text)
f.close()
