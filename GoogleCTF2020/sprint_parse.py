
import re


instructionCodeRaw = "253124303030373473253324686e2531243635343632732531242a382473253724686e00253124303031303873253324686e2531243635343238732531243173253624686e00253124303031343973253324686e2531243635333837732531242a3824732531243273253724686e00253124303031383373253324686e2531243635333533732531243173253624686e00253124303032313873253324686e253124363533313873253124327325313124686e00253124303032363473253324686e2531243635323732732531242a313024732531242a3130247325313724686e00253124303033313073253324686e2531243635323236732531243238363732732531242a31362473253724686e00253124303033343773253324686e2531243635313839732531242a35247325313524686e0025313424632531243030343139732532246325342473253124363534393973253324686e00253124303034333073253324686e2531243635313036732531242a313024732531242a3130247325313324686e00253124303034363873253324686e253124363530363873253124363535313973253724686e00253124303035303573253324686e2531243635303331732531242a31322473253624686e00253124303035343373253324686e253124363439393373253124363535323073253724686e00253124303035383073253324686e2531243634393536732531242a35247325313524686e0025313424632531243030313836732532246325342473253124303034323973253324686e00253124303036363373253324686e2531243634383733732531242a313224732531242a3132247325313724686e00253124303037303973253324686e2531243634383237732531243238363732732531242a31362473253724686e00253124303037343373253324686e2531243634373933732531243173253624686e00253124303037383973253324686e2531243634373437732531242a313224732531242a3130247325313324686e00253124303034333073253324686e00253124303038343773253324686e2531243634363839732531242a31302473253124317325313124686e0025313024632531243634383639732532246325342473253124303135343973253324686e00253124303039323273253324686e253124363436313473253124353733343473253924686e00253124303039353773253324686e253124363435373973253124307325313124686e00253124303039393373253324686e2531243634353433732531242a382473253724686e00253124303130333073253324686e2531243634353036732531242a35247325313324686e0025313224632531243030303134732532246325342473253124303130353173253324686e00253124303131383573253324686e00253124303131323973253324686e2531243634343037732531242a3130247325312436353533357325313124686e00253124303131373073253324686e2531243634333636732531242a3824732531243173253924686e00253124303039353773253324686e00253124303132333273253324686e2531243634333034732531242a3130247325312430303235347325313724686e0025313624632531243030303134732532246325342473253124303132353373253324686e00253124303133333473253324686e00253124303133313973253324686e253124363432313773253124357325323324686e00253124303530383173253324686e00253124303133363873253324686e2531243634313638732531243073253924686e00253124303134303373253324686e253124363431333373253124307325313124686e00253124303134343173253324686e253124363430393573253124363136393673253724686e00253124303134373873253324686e2531243634303538732531242a35247325313324686e00253124303135313373253324686e253124363430323373253124317325313524686e00253124303135343873253324686e253124363339383873253124307325323324686e00253124303135393373253324686e2531243633393433732531243537333434732531242a382473253724686e00253124303136333073253324686e2531243633393036732531242a35247325313724686e0025313624632531243030303134732532246325342473253124303136353173253324686e00253124303334373973253324686e00253124303137323373253324686e2531243633383133732531242a3824732531243173253924686e00253124303137373073253324686e2531243633373636732531242a3136247325312436353431397325313924686e0025313824632531243030303533732532246325342473253124303137353273253324686e00253124303138343673253324686e25312436333639307325312436353532307325313724686e00253124303233373373253324686e00253124303139303873253324686e2531243633363238732531242a3136247325312436353432327325313924686e0025313824632531243030303439732532246325342473253124303138393473253324686e00253124303139383073253324686e253124363335353673253124317325313724686e00253124303233373373253324686e00253124303230343273253324686e2531243633343934732531242a3136247325312436353433367325313924686e0025313824632531243030303530732532246325342473253124303230323773253324686e00253124303231313573253324686e25312436333432317325312431367325313724686e00253124303233373373253324686e00253124303231373773253324686e2531243633333539732531242a3136247325312436353432387325313924686e0025313824632531243030303533732532246325342473253124303231353973253324686e00253124303232353373253324686e25312436333238337325312436353533357325313724686e00253124303233373373253324686e00253124303233303373253324686e253124363332333373253124307325313524686e00253124303233333873253324686e253124363331393873253124307325313724686e00253124303233373373253324686e253124363331363373253124317325323324686e00253124303234313973253324686e2531243633313137732531242a313224732531242a3136247325313324686e00253124303234353773253324686e253124363330373973253124363535313973253724686e00253124303234393473253324686e2531243633303432732531242a31322473253624686e00253124303235333273253324686e253124363330303473253124363535323073253724686e00253124303235363973253324686e2531243632393637732531242a35247325313724686e0025313624632531243030383232732532246325342473253124303137383273253324686e00253124303236353273253324686e2531243632383834732531243631343430732531242a31322473253724686e00253124303236383973253324686e2531243632383437732531242a35247325313724686e00253124303237323773253324686e253124363238303973253124363535313973253724686e00253124303237363473253324686e2531243632373732732531242a31362473253624686e00253124303238303273253324686e253124363237333473253124363535323073253724686e00253124303238333673253324686e2531243632373030732531243073253624686e00253124303238373473253324686e253124363236363273253124363535313973253724686e00253124303239313173253324686e2531243632363235732531242a35247325313724686e00253124303239353773253324686e2531243632353739732531242a313624732531242a3136247325313724686e00253124303330303373253324686e2531243632353333732531243238363732732531242a31362473253724686e00253124303330343073253324686e2531243632343936732531242a35247325313724686e0025313624632531243030323636732532246325342473253124303238303973253324686e00253124303331323073253324686e2531243632343136732531242a31302473253124317325313724686e00253124303331363673253324686e2531243632333730732531243631363938732531242a31362473253724686e00253124303332303373253324686e2531243632333333732531242a35247325313724686e00253124303332343973253324686e2531243632323837732531242a313624732531242a3132247325313724686e0025313624632531243030303432732532246325342473253124303332343273253324686e00253124303333323973253324686e2531243632323037732531242a31302473253124317325313124686e00253124303135343873253324686e00253124303333373973253324686e253124363231353773253124307325313524686e00253124303334313473253324686e253124363231323273253124327325323324686e00253124303135343873253324686e00253124303334363473253324686e253124363230373273253124347325323324686e00253124363535333473253324686e0025313424632531243030303134732532246325342473253124303335303073253324686e00253124303530383173253324686e00253124303335373873253324686e2531243631393538732531242a3130247325312436353532377325313724686e0025313624632531243030303134732532246325342473253124303335393973253324686e00253124303336383073253324686e00253124303336363573253324686e253124363138373173253124337325323324686e00253124303530383173253324686e00253124303337313473253324686e2531243631383232732531243073253924686e00253124303337343973253324686e253124363137383773253124307325313124686e00253124303337393573253324686e2531243631373431732531242a38247325312436353439377325313324686e0025313224632531243030303134732532246325342473253124303338313673253324686e00253124303439383773253324686e00253124303338383273253324686e253124363136353473253124347325313524686e00253124303339313773253324686e253124363136313973253124307325313324686e00253124303339363373253324686e2531243631353733732531242a313224732531242a3132247325313324686e00253124303430303973253324686e2531243631353237732531242a313224732531242a3132247325313324686e00253124303430353573253324686e2531243631343831732531243537333434732531242a31302473253724686e00253124303430393273253324686e2531243631343434732531242a35247325313724686e00253124303431333973253324686e2531243631333937732531242a3136247325312436353431397325313924686e0025313824632531243030303134732532246325342473253124303431363073253324686e00253124303436333273253324686e00253124303432333873253324686e2531243631323938732531242a3136247325312436353432327325313924686e0025313824632531243030303537732532246325342473253124303432313673253324686e00253124303433313873253324686e2531243631323138732531242a31322473253124317325313324686e00253124303436333273253324686e00253124303433383073253324686e2531243631313536732531242a3136247325312436353433367325313924686e0025313824632531243030303537732532246325342473253124303433353873253324686e00253124303434363073253324686e2531243631303736732531242a31322473253124327325313324686e00253124303436333273253324686e00253124303435323273253324686e2531243631303134732531242a3136247325312436353432387325313924686e0025313824632531243030303537732532246325342473253124303435303073253324686e00253124303436303273253324686e2531243630393334732531242a31322473253124337325313324686e00253124303436333273253324686e00253124303530383173253324686e00253124303436373573253324686e2531243630383631732531242a31302473253124317325313124686e00253124303437323273253324686e2531243630383134732531242a3134247325312436353533357325313524686e0025313424632531243634363933732532246325342473253124303536303073253324686e00253124303438303473253324686e2531243630373332732531243631373038732531242a382473253724686e00253124303438343173253324686e2531243630363935732531242a35247325313524686e00253124303438383673253324686e2531243630363530732531243539333932732531242a382473253724686e00253124303439333173253324686e2531243630363035732531242a313424732531242a31322473253624686e00253124303439373273253324686e2531243630353634732531242a3824732531243173253924686e00253124303337343973253324686e00253124303530333273253324686e2531243630353034732531243539333932732531242a382473253724686e00253124303530363673253324686e2531243630343730732531243073253624686e00253124363535333473253324686e00253124303531313973253324686e253124363034313773253124353933393273253724686e00253124303531353373253324686e2531243630333833732531243073253624686e00253124363535333473253324686e00"
instructionCodeRaw = "%1$00038s%3$hn%1$65498s%1$28672s%9$hn\x00" + instructionCodeRaw.decode("hex")
instructionCode = instructionCodeRaw.split("\x00")[:-1]


def parseOpcode(str):
    x = re.search("^1\$(\d+)s", opcode)
    if x != None:
        amount = int(x.group(1),10)
        return ("PUSH", amount)
        
    x = re.search("^1\$\*(\d+)\$s", opcode)
    if x != None:
        at = int(x.group(1),10)
        return ("PUSH_FROM", at)
        
    x = re.search("^(\d+)\$hn", opcode)
    if x != None:
        at = int(x.group(1),10)
        return ("WRITE_SHORT", at)
        
    x = re.search("^(\d+)\$c", opcode)
    if x != None:
        at = int(x.group(1),10)
        return ("C", at)
        
    x = re.search("^(\d+)\$s", opcode)
    if x != None:
        at = int(x.group(1),10)
        return ("PUSH_VAR", at)
        
    return None
    
def relabel(i, access=False):
     if access and i >3:
        i = i + 1
     things = ["", "0", "pc", "0x6000000", "[[regA]]", "[regA]", "regA", "[regB]", "regB", "[regC]", "regC", "[regD]", "regD", "[regE]", "regE", "[regF]", "regF", "[regG]", "regG", "[regH]", "regH", "[regI]", "regI"]
     return things[i-1]

instructionCode = instructionCode
parsedCode = []
index = 0
for inst in instructionCode: 
    opcodes = inst.split("%")[1:]
    for opcode in opcodes:
        v = parseOpcode(opcode)
        if v != None:
            parsedCode.append((v[0], v[1], index))
        else: 
            print(opcode)
    parsedCode.append(("NEXT", 0, index)) 
    index = index + len(inst)+1
    
print(str(len(instructionCode))+" INSTRUCTIONS:")
    
optimized = []
pushAmount = 0
pushFrom = []
pushVar = []
pushC = []


for par in parsedCode:
    if par[0] == "PUSH":
        pushAmount = pushAmount + par[1]
    elif par[0] == "WRITE_SHORT":
        res = (par[1],pushAmount,pushFrom, pushVar, pushC, par[2])
        optimized.append(res)
        pushFrom = []
    elif par[0] == "PUSH_FROM":
        pushFrom.append(par[1])
    elif par[0] == "PUSH_VAR":
        pushVar.append(par[1])
        pushAmount = (pushAmount+1)*2
    elif par[0] == "C":
        pushC.append(par[1])
    elif par[0] == "NEXT":
        pushAmount = 0
        pushFrom = []
        pushVar = []
        pushC = []
   
nextLine = [0]
line = ("")

for o in optimized:
    if not (o[5] in nextLine):
        print(line)
    value = o[1] & 0xFFFF
    offset = hex(value)
    pushFrom = [relabel(i, True) for i in o[2]]
    pushVar = [relabel(i, True) for i in o[3]]
    pushC = [relabel(i, True) for i in o[4]]
    if o[2] == [] and o[3] == [] and o[4] == []:
        line = (("%04X:  " % o[5]) + ""+relabel(o[0])+" = "+offset)
    elif o[3] == [] and o[4] == []:
        s = ""
        if value != 0:
            s = offset +" + "
        for pF in pushFrom:
            s = s + pF + " + "
        s = s[:-3]
        line = (("%04X:  " % o[5]) + ""+relabel(o[0])+" = "+s)
    elif o[4] != []:
        line = (("%04X:  " % o[5]) + "if("+pushC[0]+" != 0) " +relabel(o[0])+" = "+hex(value+1))
    else:
        line = (("%04X:  " % o[5]) + ""+relabel(o[0])+" = "+str((offset, pushFrom, pushVar, pushC)))
        
    if o[0] == 3:
        nextLine = [o[5], value]
    else:
        print(line)